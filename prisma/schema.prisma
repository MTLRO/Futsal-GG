generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Player {
  id          Int          @id @default(autoincrement())
  firstName   String
  lastName    String
  elo         Int          @default(1000)
  totalGoals  Int          @default(0)
  wins        Int          @default(0)
  draws       Int          @default(0)
  losses      Int          @default(0)
  gamesPlayed Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @default(now()) @updatedAt
  available   Boolean      @default(false)
  gamePlayers GamePlayer[]

  @@index([elo])
  @@index([lastName, firstName])
}

model Session {
  id                Int           @id @default(autoincrement())
  date              DateTime      @default(now())
  team1PlayerIds    Int[]
  team2PlayerIds    Int[]
  team3PlayerIds    Int[]
  status            SessionStatus @default(SCHEDULED)
  createdAt         DateTime      @default(now())
  completedAt       DateTime?
  gameLengthMinutes Int           @default(7)
  games             Game[]

  @@index([date])
  @@index([status])
}

model Game {
  id              Int
  sessionId       Int
  homeTeamNumber  Team
  awayTeamNumber  Team
  durationSeconds Int?
  status          GameStatus   @default(IN_PROGRESS)
  startedAt       DateTime     @default(now())
  session         Session      @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  gamePlayers     GamePlayer[]

  @@id([sessionId, id])
  @@index([status])
}

model GamePlayer {
  sessionId  Int
  gameId     Int
  playerId   Int
  goals      Int    @default(0)
  eloChange  Int?
  player     Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  game       Game   @relation(fields: [sessionId, gameId], references: [sessionId, id], onDelete: Cascade)
  @@id([sessionId, gameId, playerId])
}

model GameMaster {
  id           Int      @id @default(autoincrement())
  passwordHash String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

enum SessionStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
}

enum Team {
  TEAM_1
  TEAM_2
  TEAM_3
}

enum GameStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}
